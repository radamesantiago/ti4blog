# -*- coding: utf-8 -*-
# from django.shortcuts import render_to_response
# from django.template import RequestContext
from posts.models import Post
from datetime import datetime
from django.utils.timezone import utc

def index(request):
    if request.method == 'GET':
        return render_to_response('index.html',{
            'jogo': Jogo.objects.all(),
            'estatistica': estatistica(),
            'boloes': Bolao.objects.all(),
            'tempos': tempo()
        }, context_instance=RequestContext(request))
    elif request.method == 'POST':
        if login(request.POST['usuario']):
            try:
                bolao_edit = Bolao.objects.get(apostador_id=request.POST['usuario'], jogo_id=request.POST['numero'])
                editar(bolao_edit, request.POST['placar1'], request.POST['placar2'])
                msg = "Editou!!"
            except Bolao.DoesNotExist:
                p1 = request.POST['placar1']
                p2 = request.POST['placar2']
                bolao = Bolao(
                    placar1 = p1,
                    placar2 = p2
                )
                bolao.jogo = Jogo.objects.get(pk=request.POST['numero'])
                bolao.apostador = Apostador.objects.get(pk=request.POST['usuario'])

                aposta = Aposta.objects.get(jogo_id=bolao.jogo)

                if p1 > p2:
                    aposta.selecao1+=1
                elif p1 < p2:
                    aposta.selecao2+=1
                else:
                    aposta.empate+=1

                try:
                    aposta.save()
                    bolao.save()
                    msg='Deu Certo!!'
                except Exception, e:
                    msg = e

            return render_to_response('index.html',{
                'jogo': Jogo.objects.all(),#.order_by('-publication_date')
                'estatistica': estatistica(),
                'boloes': Bolao.objects.all(),
                'apostador': request.POST['usuario'],
                'msg':msg
            }, context_instance=RequestContext(request))
        else:
            return render_to_response('index.html', {'teste': 'VocÃª tem que logar antes de apostar!!'}, context_instance=RequestContext(request))

